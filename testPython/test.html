<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Scoreboard & Queue</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        h1, h2 {
            color: #333;
            margin-bottom: 20px;
        }
        .scoreboard {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 20px;
            align-items: center;
            margin-bottom: 30px;
        }
        .team {
            text-align: center;
        }
        .team-name {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #667eea;
            word-wrap: break-word;
        }
        .streak {
            font-size: 14px;
            color: #f59e0b;
            margin-bottom: 10px;
            font-weight: bold;
            min-height: 20px;
        }
        .score {
            font-size: 48px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        .btn-group {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            -webkit-tap-highlight-color: transparent;
        }
        button:active {
            transform: scale(0.95);
        }
        .btn-plus {
            background: #4ade80;
            color: white;
        }
        .btn-minus {
            background: #f87171;
            color: white;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        .btn-secondary {
            background: #64748b;
            color: white;
        }
        .vs {
            font-size: 32px;
            font-weight: bold;
            color: #764ba2;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        input:focus {
            outline: none;
            border-color: #667eea;
        }
        .queue-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .queue-teams {
            font-weight: bold;
            color: #333;
        }
        .team-chip {
            background: #e0e7ff;
            color: #4338ca;
            padding: 8px 16px;
            border-radius: 20px;
            margin: 5px;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: bold;
        }
        .team-chip button {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            padding: 0;
            font-size: 12px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }
        .stat-item {
            background: #f8fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }
        .stat-name {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .stat-record {
            color: #667eea;
            font-size: 18px;
        }
        .controls {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .info-box {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
        }
        .info-box h3 {
            color: #92400e;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .info-box p {
            color: #78350f;
            font-size: 14px;
            line-height: 1.5;
        }
        .teams-container {
            display: flex;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        @media (max-width: 600px) {
            .scoreboard {
                grid-template-columns: 1fr;
                gap: 30px;
            }
            .vs {
                font-size: 24px;
            }
            .score {
                font-size: 36px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h1>üèÜ Scoreboard</h1>
            <div class="scoreboard">
                <div class="team">
                    <div class="team-name" id="team1Name">Team 1</div>
                    <div class="streak" id="team1Streak"></div>
                    <div class="score" id="score1">0</div>
                    <div class="btn-group">
                        <button class="btn-plus" onclick="updateScore(1, 1)">+1</button>
                        <button class="btn-minus" onclick="updateScore(1, -1)">-1</button>
                    </div>
                </div>
                <div class="vs">VS</div>
                <div class="team">
                    <div class="team-name" id="team2Name">Team 2</div>
                    <div class="streak" id="team2Streak"></div>
                    <div class="score" id="score2">0</div>
                    <div class="btn-group">
                        <button class="btn-plus" onclick="updateScore(2, 1)">+1</button>
                        <button class="btn-minus" onclick="updateScore(2, -1)">-1</button>
                    </div>
                </div>
            </div>
            <div class="controls">
                <button class="btn-primary" onclick="finishMatch()">Finish Match</button>
                <button class="btn-secondary" onclick="resetScore()">Reset Score</button>
            </div>
        </div>

        <div class="card">
            <h2>üë• Teams Management</h2>
            <div class="info-box">
                <h3>üìã How it works:</h3>
                <p>‚Ä¢ Add teams one at a time to the pool<br>
                ‚Ä¢ Winner stays, loser goes to back of queue<br>
                ‚Ä¢ With 3 teams: Winner stays indefinitely<br>
                ‚Ä¢ With 4+ teams: Winner goes to queue after 2 consecutive wins<br>
                ‚Ä¢ Next team in queue replaces the loser</p>
            </div>
            <input type="text" id="newTeam" placeholder="Enter team name">
            <button class="btn-primary" onclick="addTeam()" style="width: 100%; margin-bottom: 20px;">Add Team</button>
            
            <h3 style="margin-top: 20px; margin-bottom: 10px;">All Teams (<span id="teamCount">0</span>)</h3>
            <div class="teams-container" id="teamsList"></div>
        </div>

        <div class="card">
            <h2>üéØ Current Queue</h2>
            <p style="color: #64748b; margin-bottom: 15px;">Next team to play: <strong id="nextTeam">-</strong></p>
            <div id="queueList"></div>
        </div>

        <div class="card">
            <h2>üìä Team Statistics</h2>
            <div class="stats-grid" id="statsList"></div>
            <button class="btn-danger" onclick="clearStats()" style="width: 100%; margin-top: 20px;">Clear All Stats</button>
        </div>
    </div>

    <script>
        // Initialize data structure
        let data = {
            current_match: {
                team1: '',
                team2: '',
                score1: 0,
                score2: 0,
                team1_streak: 0,
                team2_streak: 0
            },
            queue: [],
            all_teams: [],
            stats: {}
        };

        // Load data from localStorage
        function loadFromStorage() {
            const saved = localStorage.getItem('scoreboard_data');
            if (saved) {
                data = JSON.parse(saved);
            }
            updateUI();
        }

        // Save data to localStorage
        function saveToStorage() {
            localStorage.setItem('scoreboard_data', JSON.stringify(data));
        }

        // Update the entire UI
        function updateUI() {
            // Update scoreboard
            document.getElementById('team1Name').textContent = data.current_match.team1 || 'Team 1';
            document.getElementById('team2Name').textContent = data.current_match.team2 || 'Team 2';
            document.getElementById('score1').textContent = data.current_match.score1;
            document.getElementById('score2').textContent = data.current_match.score2;
            
            // Update streaks
            const streak1 = data.current_match.team1_streak || 0;
            const streak2 = data.current_match.team2_streak || 0;
            document.getElementById('team1Streak').textContent = streak1 > 0 ? `üî• ${streak1} win streak` : '';
            document.getElementById('team2Streak').textContent = streak2 > 0 ? `üî• ${streak2} win streak` : '';

            // Update all teams
            const teamsList = document.getElementById('teamsList');
            teamsList.innerHTML = '';
            document.getElementById('teamCount').textContent = data.all_teams.length;
            data.all_teams.forEach(team => {
                const chip = document.createElement('div');
                chip.className = 'team-chip';
                chip.innerHTML = `
                    ${team}
                    <button onclick="removeTeam('${team.replace(/'/g, "\\'")}')">√ó</button>
                `;
                teamsList.appendChild(chip);
            });

            // Update queue display
            const queueList = document.getElementById('queueList');
            queueList.innerHTML = '';
            if (data.queue.length === 0) {
                queueList.innerHTML = '<p style="color: #64748b;">Queue is empty</p>';
                document.getElementById('nextTeam').textContent = '-';
            } else {
                document.getElementById('nextTeam').textContent = data.queue[0];
                data.queue.forEach((team, idx) => {
                    const div = document.createElement('div');
                    div.className = 'queue-item';
                    div.innerHTML = `<span class="queue-teams">#${idx + 1}: ${team}</span>`;
                    queueList.appendChild(div);
                });
            }

            // Update stats
            const statsList = document.getElementById('statsList');
            statsList.innerHTML = '';
            Object.entries(data.stats).forEach(([team, record]) => {
                const div = document.createElement('div');
                div.className = 'stat-item';
                div.innerHTML = `
                    <div class="stat-name">${team}</div>
                    <div class="stat-record">${record.wins}W - ${record.losses}L</div>
                `;
                statsList.appendChild(div);
            });
        }

        function updateScore(team, delta) {
            if (team === 1) {
                data.current_match.score1 = Math.max(0, data.current_match.score1 + delta);
            } else {
                data.current_match.score2 = Math.max(0, data.current_match.score2 + delta);
            }
            saveToStorage();
            updateUI();
        }

        function resetScore() {
            if (confirm('Reset current scores to 0?')) {
                data.current_match.score1 = 0;
                data.current_match.score2 = 0;
                saveToStorage();
                updateUI();
            }
        }

        function finishMatch() {
            const team1 = data.current_match.team1;
            const team2 = data.current_match.team2;
            const score1 = data.current_match.score1;
            const score2 = data.current_match.score2;
            
            if (!team1 || !team2) {
                alert('Need at least 2 teams playing to finish a match');
                return;
            }
            
            if (score1 === score2) {
                alert('Cannot finish match with a tie. Please adjust scores.');
                return;
            }
            
            // Initialize stats if needed
            if (!data.stats[team1]) {
                data.stats[team1] = { wins: 0, losses: 0 };
            }
            if (!data.stats[team2]) {
                data.stats[team2] = { wins: 0, losses: 0 };
            }
            
            // Determine winner and loser
            let winner, loser, winner_streak, loser_pos;
            if (score1 > score2) {
                winner = team1;
                loser = team2;
                winner_streak = data.current_match.team1_streak + 1;
                loser_pos = 1;
            } else {
                winner = team2;
                loser = team1;
                winner_streak = data.current_match.team2_streak + 1;
                loser_pos = 0;
            }
            
            // Update stats
            data.stats[winner].wins += 1;
            data.stats[loser].losses += 1;
            
            // Add loser to back of queue
            const loserIndex = data.queue.indexOf(loser);
            if (loserIndex > -1) {
                data.queue.splice(loserIndex, 1);
            }
            data.queue.push(loser);
            
            const total_teams = data.all_teams.length;
            let message = `${winner} wins! `;
            
            // Check if winner should go to queue
            if (total_teams > 3 && winner_streak >= 2) {
                // Winner has won 2 games, send to queue
                const winnerIndex = data.queue.indexOf(winner);
                if (winnerIndex > -1) {
                    data.queue.splice(winnerIndex, 1);
                }
                data.queue.push(winner);
                message += `${winner} has won 2 games in a row and goes to the queue. `;
                
                // Get next 2 teams from queue
                if (data.queue.length >= 2) {
                    const next_team1 = data.queue.shift();
                    const next_team2 = data.queue.shift();
                    data.current_match = {
                        team1: next_team1,
                        team2: next_team2,
                        score1: 0,
                        score2: 0,
                        team1_streak: 0,
                        team2_streak: 0
                    };
                    message += `Next match: ${next_team1} vs ${next_team2}`;
                } else {
                    data.current_match = {
                        team1: '',
                        team2: '',
                        score1: 0,
                        score2: 0,
                        team1_streak: 0,
                        team2_streak: 0
                    };
                    message += 'Not enough teams in queue for next match.';
                }
            } else {
                // Winner stays, loser replaced
                message += `${winner} stays on (streak: ${winner_streak}). `;
                
                // Get next team from queue to replace loser
                if (data.queue.length > 0 && data.queue[0] !== winner) {
                    const next_team = data.queue.shift();
                    
                    // Update current match - winner stays in same position
                    if (loser_pos === 0) {
                        data.current_match = {
                            team1: next_team,
                            team2: winner,
                            score1: 0,
                            score2: 0,
                            team1_streak: 0,
                            team2_streak: winner_streak
                        };
                    } else {
                        data.current_match = {
                            team1: winner,
                            team2: next_team,
                            score1: 0,
                            score2: 0,
                            team1_streak: winner_streak,
                            team2_streak: 0
                        };
                    }
                    message += `${next_team} comes in to challenge!`;
                } else {
                    data.current_match = {
                        team1: '',
                        team2: '',
                        score1: 0,
                        score2: 0,
                        team1_streak: 0,
                        team2_streak: 0
                    };
                    message += 'No teams in queue to replace loser.';
                }
            }
            
            saveToStorage();
            updateUI();
            alert(message);
        }

        function addTeam() {
            const team = document.getElementById('newTeam').value.trim();
            
            if (!team) {
                alert('Please enter a team name');
                return;
            }
            
            if (data.all_teams.includes(team)) {
                alert('Team already exists');
                return;
            }
            
            data.all_teams.push(team);
            
            // Initialize stats
            if (!data.stats[team]) {
                data.stats[team] = { wins: 0, losses: 0 };
            }
            
            // Auto-setup initial match
            if (!data.current_match.team1) {
                data.current_match.team1 = team;
                data.current_match.team1_streak = 0;
            } else if (!data.current_match.team2) {
                data.current_match.team2 = team;
                data.current_match.team2_streak = 0;
            } else {
                // Add to queue
                data.queue.push(team);
            }
            
            document.getElementById('newTeam').value = '';
            saveToStorage();
            updateUI();
        }

        function removeTeam(team) {
            if (confirm(`Remove ${team} from the system?`)) {
                // Remove from all_teams
                const teamIndex = data.all_teams.indexOf(team);
                if (teamIndex > -1) {
                    data.all_teams.splice(teamIndex, 1);
                }
                
                // Remove from queue
                const queueIndex = data.queue.indexOf(team);
                if (queueIndex > -1) {
                    data.queue.splice(queueIndex, 1);
                }
                
                // Remove from current match if present
                if (data.current_match.team1 === team) {
                    data.current_match.team1 = '';
                    data.current_match.team1_streak = 0;
                    data.current_match.score1 = 0;
                }
                if (data.current_match.team2 === team) {
                    data.current_match.team2 = '';
                    data.current_match.team2_streak = 0;
                    data.current_match.score2 = 0;
                }
                
                saveToStorage();
                updateUI();
            }
        }

        function clearStats() {
            if (confirm('Clear all team statistics? This cannot be undone.')) {
                data = {
                    current_match: {
                        team1: '',
                        team2: '',
                        score1: 0,
                        score2: 0,
                        team1_streak: 0,
                        team2_streak: 0
                    },
                    queue: [],
                    all_teams: [],
                    stats: {}
                };
                saveToStorage();
                updateUI();
            }
        }

        // Load data on page load
        loadFromStorage();
    </script>
</body>
</html>